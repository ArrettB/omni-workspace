CREATE view CRYSTAL_CUSTOMER_INVOICE_INTERCOMPANY_DISTRIBUTIONS
as
SELECT     'AMBIM' as COMPANY,AMBIM.dbo.SOP30200.SOPTYPE, AMBIM.dbo.SOP30200.SOPNUMBE, AMBIM.dbo.RM00101.CUSTNMBR, AMBIM.dbo.RM00101.CUSTNAME, 
                      AMBIM.dbo.RM00101.CUSTCLAS, AMBIM.dbo.SOP30200.DOCID, AMBIM.dbo.SOP30200.DOCDATE, AMBIM.dbo.SOP30200.GLPOSTDT, 
                      AMBIM.dbo.SOP30200.ORIGTYPE, AMBIM.dbo.SOP30200.ORIGNUMB, AMBIM.dbo.SOP30200.CSTPONBR, AMBIM.dbo.SOP30200.DOCAMNT, 
                      AMBIM.dbo.SOP10102.ACTINDX, AMBIM.dbo.SOP10102.DEBITAMT, AMBIM.dbo.SOP10102.ORDBTAMT, AMBIM.dbo.SOP10102.CRDTAMNT, 
                      AMBIM.dbo.SOP10102.ORCRDAMT, LEFT(ISNULL(RTRIM(AMBIM.dbo.GL00100.ACTNUMBR_1), '') 
                      + '-' + ISNULL(RTRIM(AMBIM.dbo.GL00100.ACTNUMBR_2), '') + '-' + ISNULL(RTRIM(AMBIM.dbo.GL00100.ACTNUMBR_3), '') 
                      + '-' + ISNULL(RTRIM(AMBIM.dbo.GL00100.ACTNUMBR_4), '') + '-' + ISNULL(RTRIM(AMBIM.dbo.GL00100.ACTNUMBR_5), ''), 13) AS ACTNUM
FROM         AMBIM.dbo.SOP30200 INNER JOIN
                      AMBIM.dbo.SOP10102 ON AMBIM.dbo.SOP30200.SOPTYPE = AMBIM.dbo.SOP10102.SOPTYPE AND 
                      AMBIM.dbo.SOP30200.SOPNUMBE = AMBIM.dbo.SOP10102.SOPNUMBE INNER JOIN
                      AMBIM.dbo.GL00100 ON AMBIM.dbo.SOP10102.ACTINDX = AMBIM.dbo.GL00100.ACTINDX LEFT OUTER JOIN
                      AMBIM.dbo.RM00101 ON AMBIM.dbo.SOP30200.CUSTNMBR = AMBIM.dbo.RM00101.CUSTNMBR
GROUP BY AMBIM.dbo.SOP30200.SOPTYPE, AMBIM.dbo.SOP30200.SOPNUMBE, AMBIM.dbo.RM00101.CUSTNMBR, AMBIM.dbo.RM00101.CUSTNAME, 
                      AMBIM.dbo.RM00101.CUSTCLAS, AMBIM.dbo.SOP30200.DOCID, AMBIM.dbo.SOP30200.DOCDATE, AMBIM.dbo.SOP30200.GLPOSTDT, 
                      AMBIM.dbo.SOP30200.ORIGTYPE, AMBIM.dbo.SOP30200.ORIGNUMB, AMBIM.dbo.SOP30200.CSTPONBR, AMBIM.dbo.SOP30200.DOCAMNT, 
                      AMBIM.dbo.SOP10102.ACTINDX, AMBIM.dbo.SOP10102.DEBITAMT, AMBIM.dbo.SOP10102.ORDBTAMT, AMBIM.dbo.SOP10102.CRDTAMNT, 
                      AMBIM.dbo.SOP10102.ORCRDAMT, AMBIM.dbo.GL00100.ACTNUMBR_1, AMBIM.dbo.GL00100.ACTNUMBR_2, AMBIM.dbo.GL00100.ACTNUMBR_3, 
                      AMBIM.dbo.GL00100.ACTNUMBR_4, AMBIM.dbo.GL00100.ACTNUMBR_5,AMBIM.dbo.SOP30200.VOIDSTTS
HAVING      (AMBIM.dbo.SOP30200.SOPTYPE IN (3,4)) and AMBIM.dbo.SOP30200.VOIDSTTS in (0)
union
SELECT     'AIA' as COMPANY,AIA.dbo.SOP30200.SOPTYPE, AIA.dbo.SOP30200.SOPNUMBE, AIA.dbo.RM00101.CUSTNMBR, AIA.dbo.RM00101.CUSTNAME, 
                      AIA.dbo.RM00101.CUSTCLAS, AIA.dbo.SOP30200.DOCID, AIA.dbo.SOP30200.DOCDATE, AIA.dbo.SOP30200.GLPOSTDT, 
                      AIA.dbo.SOP30200.ORIGTYPE, AIA.dbo.SOP30200.ORIGNUMB, AIA.dbo.SOP30200.CSTPONBR, AIA.dbo.SOP30200.DOCAMNT, 
                      AIA.dbo.SOP10102.ACTINDX, AIA.dbo.SOP10102.DEBITAMT, AIA.dbo.SOP10102.ORDBTAMT, AIA.dbo.SOP10102.CRDTAMNT, 
                      AIA.dbo.SOP10102.ORCRDAMT, LEFT(ISNULL(RTRIM(AIA.dbo.GL00100.ACTNUMBR_1), '') 
                      + '-' + ISNULL(RTRIM(AIA.dbo.GL00100.ACTNUMBR_2), '') + '-' + ISNULL(RTRIM(AIA.dbo.GL00100.ACTNUMBR_3), '') 
                      + '-' + ISNULL(RTRIM(AIA.dbo.GL00100.ACTNUMBR_4), '') + '-' + ISNULL(RTRIM(AIA.dbo.GL00100.ACTNUMBR_5), ''), 13) AS ACTNUM
FROM         AIA.dbo.SOP30200 INNER JOIN
                      AIA.dbo.SOP10102 ON AIA.dbo.SOP30200.SOPTYPE = AIA.dbo.SOP10102.SOPTYPE AND 
                      AIA.dbo.SOP30200.SOPNUMBE = AIA.dbo.SOP10102.SOPNUMBE INNER JOIN
                      AIA.dbo.GL00100 ON AIA.dbo.SOP10102.ACTINDX = AIA.dbo.GL00100.ACTINDX LEFT OUTER JOIN
                      AIA.dbo.RM00101 ON AIA.dbo.SOP30200.CUSTNMBR = AIA.dbo.RM00101.CUSTNMBR
GROUP BY AIA.dbo.SOP30200.SOPTYPE, AIA.dbo.SOP30200.SOPNUMBE, AIA.dbo.RM00101.CUSTNMBR, AIA.dbo.RM00101.CUSTNAME, 
                      AIA.dbo.RM00101.CUSTCLAS, AIA.dbo.SOP30200.DOCID, AIA.dbo.SOP30200.DOCDATE, AIA.dbo.SOP30200.GLPOSTDT, 
                      AIA.dbo.SOP30200.ORIGTYPE, AIA.db
