CREATE view CRYSTAL_CUSTOMER_INVOICE_INTERCOMPANY
as
SELECT     'AMBIM' AS COMPANY, AMBIM.dbo.SOP30200.SOPTYPE, AMBIM.dbo.SOP30200.SOPNUMBE, AMBIM.dbo.RM00101.CUSTNMBR, AMBIM.dbo.RM00101.CUSTNAME, AMBIM.dbo.RM00101.CUSTCLAS, 
                      AMBIM.dbo.SOP30200.DOCID, AMBIM.dbo.SOP30200.DOCDATE, AMBIM.dbo.SOP30200.GLPOSTDT, AMBIM.dbo.SOP30200.ORIGTYPE, AMBIM.dbo.SOP30200.ORIGNUMB, AMBIM.dbo.SOP30200.CSTPONBR, 
                      case AMBIM.dbo.SOP30200.SOPTYPE WHEN 3 THEN AMBIM.dbo.SOP30200.DOCAMNT WHEN 4 THEN AMBIM.dbo.SOP30200.DOCAMNT * -1 END DOCAMNT
FROM         AMBIM.dbo.SOP30200 LEFT OUTER JOIN
                      AMBIM.dbo.RM00101 ON AMBIM.dbo.SOP30200.CUSTNMBR = AMBIM.dbo.RM00101.CUSTNMBR
GROUP BY AMBIM.dbo.SOP30200.SOPTYPE, AMBIM.dbo.SOP30200.SOPNUMBE, AMBIM.dbo.RM00101.CUSTNMBR, AMBIM.dbo.RM00101.CUSTNAME, AMBIM.dbo.RM00101.CUSTCLAS, AMBIM.dbo.SOP30200.DOCID, 
         AMBIM.dbo.SOP30200.DOCDATE, AMBIM.dbo.SOP30200.GLPOSTDT, AMBIM.dbo.SOP30200.ORIGTYPE, AMBIM.dbo.SOP30200.ORIGNUMB, AMBIM.dbo.SOP30200.CSTPONBR, AMBIM.dbo.SOP30200.DOCAMNT,
				 AMBIM.dbo.SOP30200.VOIDSTTS
HAVING      (AMBIM.dbo.SOP30200.SOPTYPE IN (3,4)) and AMBIM.dbo.SOP30200.VOIDSTTS in (0)
union
SELECT     'AIA' AS COMPANY, AIA.dbo.SOP30200.SOPTYPE, AIA.dbo.SOP30200.SOPNUMBE, AIA.dbo.RM00101.CUSTNMBR, AIA.dbo.RM00101.CUSTNAME, AIA.dbo.RM00101.CUSTCLAS, 
                      AIA.dbo.SOP30200.DOCID, AIA.dbo.SOP30200.DOCDATE, AIA.dbo.SOP30200.GLPOSTDT, AIA.dbo.SOP30200.ORIGTYPE, AIA.dbo.SOP30200.ORIGNUMB, AIA.dbo.SOP30200.CSTPONBR, 
                      case AIA.dbo.SOP30200.SOPTYPE WHEN 3 THEN AIA.dbo.SOP30200.DOCAMNT WHEN 4 THEN AIA.dbo.SOP30200.DOCAMNT * -1 END DOCAMNT
FROM         AIA.dbo.SOP30200 LEFT OUTER JOIN
                      AIA.dbo.RM00101 ON AIA.dbo.SOP30200.CUSTNMBR = AIA.dbo.RM00101.CUSTNMBR
GROUP BY AIA.dbo.SOP30200.SOPTYPE, AIA.dbo.SOP30200.SOPNUMBE, AIA.dbo.RM00101.CUSTNMBR, AIA.dbo.RM00101.CUSTNAME, AIA.dbo.RM00101.CUSTCLAS, AIA.dbo.SOP30200.DOCID, 
         AIA.dbo.SOP30200.DOCDATE, AIA.dbo.SOP30200.GLPOSTDT, AIA.dbo.SOP30200.ORIGTYPE, AIA.dbo.SOP30200.ORIGNUMB, AIA.dbo.SOP30200.CSTPONBR, AIA.dbo.SOP30200.DOCAMNT,
				 AIA.dbo.SOP30200.VOIDSTTS
HAVING      (AIA.dbo.SOP30200.SOPTYPE IN (3,4)) and AIA.dbo.SOP30200.VOIDSTTS in (0)
union
SELECT     'AMCOR' AS COMPANY, AMCOR.dbo.SOP30200.SOPTYPE, AMCOR.dbo.SOP30200.SOPNUMBE, AMCOR.dbo.RM00101.CUSTNMBR, AMCOR.dbo.RM00101.CUSTNAME, AMCOR.dbo.RM00101.CUSTCLAS, 
                      AMCOR.dbo.SOP30200.DOCID, AMCOR.dbo.SOP30200.DOCDATE, AMCOR.dbo.SOP30200.GLPOSTDT, AMCOR.dbo.SOP30200.ORIGTYPE, AMCOR.dbo.SOP30200.ORIGNUMB, AMCOR.dbo.SOP30200.CSTPONBR, 
                      case AMCOR.dbo.SOP30200.SOPTYPE WHEN 3 THEN AMCOR.dbo.SOP30200.DOCAMNT WHEN 4 THEN AMCOR.dbo.SOP30200.DOCAMNT * -1 END DOCAMNT
FROM         AMCOR.dbo.SOP30200 LEFT OUTER JOIN
                      AMCOR.dbo.RM00101 ON AMCOR.dbo.SOP30200.CUSTNMBR = AMCOR.dbo.RM00101.CUSTNMBR
GROUP BY AMCOR.dbo.SOP30200.SOPTYPE, AMCOR.dbo.SOP30200.SOPNUMBE, AMCOR.dbo.RM00101.CUSTNMBR, AMCOR.dbo.RM00101.CUSTNAME, AMCOR.dbo.RM00101.CUSTCLAS, AMCOR.dbo.SOP30200.DOCID, 
         AMCOR.dbo.SOP30200.DOCDATE, AMCOR.dbo.SOP30200.GLPOSTDT, AMCOR.dbo.SOP30200.ORIGTYPE, AMCOR.dbo.SOP30200.ORIGNUMB, AMCOR.dbo.SOP30200.CSTPONBR, AMCOR.dbo.SOP30200.DOCAMNT,
				 AMCOR.dbo.SOP30200.VOIDSTTS
HAVING      (AMCOR.dbo.SOP30200.SOPTYPE IN (3,4)) and AMCOR.dbo.SOP30200.VOIDSTTS in (0)
UNION
SELECT     'AMMAD' AS COMPANY, AMMAD.dbo.SOP30200.SOPTYPE, AMMAD.dbo.SOP30200.SOPNUMBE, AMMAD.dbo.RM00101.CUSTNMBR, AMMAD.dbo.RM00101.CUSTNAME, AMMAD.dbo.RM00101.CUSTCLAS, 
                      AMMAD.dbo.SOP30200.DOCID, AMMAD.dbo.SOP30200.DOCDATE, AMMAD.dbo.SOP30200.GLPOSTDT, AMMAD.dbo.SOP30200.ORIGTYPE, AMMAD.dbo.SOP30200.ORIGNUMB, AMMAD.dbo.SOP30200.CSTPONBR, 
                      case AMMAD.dbo.SOP30200.SOPTYPE WHEN 3 THEN AMMAD.dbo.SOP30200.DOCAMNT WHEN 4 THEN AMMAD.dbo.SOP30200.DOCAMNT * -1 END DOCAMNT
FROM         AMMAD
